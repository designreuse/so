<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" xmlns:signavio="http://www.signavio.com" id="sid-0b0aaa25-3baf-4875-9d7a-0907d599a9ef" targetNamespace="http://www.omg.org/spec/BPMN/20100524/MODEL" exporter="Camunda Modeler" exporterVersion="1.3.2" xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd">
  <dataStore id="FinancialAccountingSystem" name="Financial Accounting System" isUnlimited="false">
    <dataState id="DataState_1" />
  </dataStore>
  <message id="foxMessage_en" name="foxMessage_en" />
  <collaboration id="collaboration_3">
    <participant id="Process_Engine_1" name="生产计划" />
  </collaboration>
  <process id="planOrders" name="生产计划流程" isExecutable="true">
    <laneSet id="laneSet_5">
      <lane id="Approver" name="审核">
        <flowNodeRef>approveOrder</flowNodeRef>
        <flowNodeRef>appendOrder</flowNodeRef>
        <flowNodeRef>order_is_approved</flowNodeRef>
        <flowNodeRef>order_is_maken</flowNodeRef>
      </lane>
      <lane id="salesTeam" name="销售">
        <flowNodeRef>assignApprover</flowNodeRef>
        <flowNodeRef>reviewOrder</flowNodeRef>
        <flowNodeRef>StartDraftOrderEvent</flowNodeRef>
        <flowNodeRef>review_is_ok</flowNodeRef>
        <flowNodeRef>orderCanceled</flowNodeRef>
      </lane>
      <lane id="warehousing" name="仓储">
        <flowNodeRef>pullProductService</flowNodeRef>
        <flowNodeRef>pullMaterialService</flowNodeRef>
        <flowNodeRef>pushProductService</flowNodeRef>
        <flowNodeRef>orderFinished</flowNodeRef>
      </lane>
    </laneSet>
    <dataStoreReference id="DataStoreReference_1" name="Financial Accounting System" dataStoreRef="FinancialAccountingSystem" />
    <startEvent id="StartDraftOrderEvent" name="销售订单" camunda:formKey="embedded:app:workflow/start-form.html">
      <outgoing>SequenceFlow_1</outgoing>
    </startEvent>
    <businessRuleTask id="assignApprover" name="指定审核人" camunda:resultVariable="approverGroups" camunda:decisionRef="order-assign-approver" camunda:mapDecisionResult="collectEntries">
      <incoming>SequenceFlow_1</incoming>
      <outgoing>sequenceFlow_178</outgoing>
    </businessRuleTask>
    <userTask id="approveOrder" name="审核生产订单" camunda:formKey="embedded:app:workflow/approve-order.html" camunda:candidateGroups="${approverGroups}" camunda:dueDate="${dateTime().plusWeeks(1).toDate()}">
      <documentation>订单审核通过(或不通过).</documentation>
      <extensionElements>
        <camunda:taskListener event="create">
          <camunda:script scriptFormat="javascript"><![CDATA[if(!!task.getVariable('approver')) {
  task.setAssignee(approver);
}]]></camunda:script>
        </camunda:taskListener>
        <camunda:taskListener event="assignment">
          <camunda:script scriptFormat="javascript"><![CDATA[task.setVariable('approver', task.getAssignee());]]></camunda:script>
        </camunda:taskListener>
      </extensionElements>
      <incoming>sequenceFlow_178</incoming>
      <incoming>reviewSuccessful</incoming>
      <outgoing>sequenceFlow_180</outgoing>
    </userTask>
    <endEvent id="orderFinished" name="完成订单">
      <incoming>SequenceFlow_0hm5uwp</incoming>
    </endEvent>
    <task id="pullProductService" name="产品出库">
      <incoming>SequenceFlow_3</incoming>
      <incoming>SequenceFlow_1imjp93</incoming>
      <outgoing>SequenceFlow_0hm5uwp</outgoing>
    </task>
    <exclusiveGateway id="order_is_approved" name="审核通过？" gatewayDirection="Diverging">
      <incoming>sequenceFlow_180</incoming>
      <outgoing>order_not_approved</outgoing>
      <outgoing>order_approved</outgoing>
    </exclusiveGateway>
    <userTask id="appendOrder" name="追加与合并订单" camunda:formKey="embedded:app:workflow/append-order.html" camunda:candidateGroups="planner">
      <incoming>order_approved</incoming>
      <outgoing>SequenceFlow_1gcjbut</outgoing>
    </userTask>
    <exclusiveGateway id="order_is_maken" name="是否生产？">
      <incoming>SequenceFlow_1gcjbut</incoming>
      <outgoing>SequenceFlow_1imjp93</outgoing>
      <outgoing>SequenceFlow_1pcdtz2</outgoing>
    </exclusiveGateway>
    <userTask id="reviewOrder" name="重新校验订单" camunda:formKey="embedded:app:workflow/review-order.html" camunda:assignee="demo" camunda:dueDate="${dateTime().plusDays(2).toDate()}">
      <documentation><![CDATA[请检查订单.


如果数据不全，请补充或修订.]]></documentation>
      <incoming>order_not_approved</incoming>
      <outgoing>sequenceFlow_183</outgoing>
    </userTask>
    <serviceTask id="pullMaterialService" name="库房领料" camunda:async="true" camunda:class="net.bobstudio.so.wf.service.PullMaterialService">
      <incoming>SequenceFlow_1pcdtz2</incoming>
      <outgoing>SequenceFlow_2</outgoing>
    </serviceTask>
    <serviceTask id="pushProductService" name="产品入库" camunda:async="true" camunda:class="net.bobstudio.so.wf.service.PushProductService">
      <incoming>SequenceFlow_2</incoming>
      <outgoing>SequenceFlow_3</outgoing>
    </serviceTask>
    <exclusiveGateway id="review_is_ok" name="订单修改后继续提交？" gatewayDirection="Diverging">
      <incoming>sequenceFlow_183</incoming>
      <outgoing>reviewNotSuccessful</outgoing>
      <outgoing>reviewSuccessful</outgoing>
    </exclusiveGateway>
    <endEvent id="orderCanceled" name="订单不处理">
      <incoming>reviewNotSuccessful</incoming>
    </endEvent>
    <sequenceFlow id="SequenceFlow_1" name="" sourceRef="StartDraftOrderEvent" targetRef="assignApprover" />
    <sequenceFlow id="sequenceFlow_178" isImmediate="true" sourceRef="assignApprover" targetRef="approveOrder" />
    <sequenceFlow id="reviewSuccessful" name="有效" isImmediate="true" sourceRef="review_is_ok" targetRef="approveOrder" >
      <conditionExpression xsi:type="tFormalExpression">${clarified}</conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="sequenceFlow_180" isImmediate="true" sourceRef="approveOrder" targetRef="order_is_approved" />
    <sequenceFlow id="SequenceFlow_0hm5uwp" sourceRef="pullProductService" targetRef="orderFinished" />
    <sequenceFlow id="SequenceFlow_3" name="" sourceRef="pushProductService" targetRef="pullProductService" />
    <sequenceFlow id="SequenceFlow_1imjp93" name="否" sourceRef="order_is_maken" targetRef="pullProductService" >
      <conditionExpression xsi:type="tFormalExpression">${!maken}</conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="order_not_approved" name="未通过" isImmediate="true" sourceRef="order_is_approved" targetRef="reviewOrder">
      <conditionExpression xsi:type="tFormalExpression" id="conditionExpression_56">${!approved}</conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="order_approved" name="通过" isImmediate="true" sourceRef="order_is_approved" targetRef="appendOrder">
      <conditionExpression xsi:type="tFormalExpression" id="conditionExpression_63">${approved}</conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="SequenceFlow_1gcjbut" sourceRef="appendOrder" targetRef="order_is_maken" />
    <sequenceFlow id="SequenceFlow_1pcdtz2" name="是" sourceRef="order_is_maken" targetRef="pullMaterialService" >
      <conditionExpression xsi:type="tFormalExpression">${maken}</conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="sequenceFlow_183" isImmediate="true" sourceRef="reviewOrder" targetRef="review_is_ok" />
    <sequenceFlow id="SequenceFlow_2" name="生产" sourceRef="pullMaterialService" targetRef="pushProductService" />
    <sequenceFlow id="reviewNotSuccessful" name="无效" isImmediate="true" sourceRef="review_is_ok" targetRef="orderCanceled">
      <conditionExpression xsi:type="tFormalExpression">${!clarified}</conditionExpression>
    </sequenceFlow>
    <association id="Association_1" sourceRef="DataStoreReference_1" targetRef="pullMaterialService" />
  </process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_73">
    <bpmndi:BPMNPlane id="BPMNPlane_73" bpmnElement="collaboration_3">
      <bpmndi:BPMNShape id="Process_Engine_1_gui" bpmnElement="Process_Engine_1" isHorizontal="true">
        <omgdc:Bounds x="76" y="36" width="1108" height="486" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Freigebender_105_gui" bpmnElement="Approver" isHorizontal="true">
        <omgdc:Bounds x="106" y="218" width="1078" height="161" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Team-Assistenz_110_gui" bpmnElement="salesTeam" isHorizontal="true">
        <omgdc:Bounds x="106" y="36" width="1078" height="183" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Buchhaltung_119_gui" bpmnElement="warehousing" isHorizontal="true">
        <omgdc:Bounds x="106" y="378" width="1078" height="144" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Rechnung_freigeben_125_gui" bpmnElement="approveOrder" isHorizontal="true">
        <omgdc:Bounds x="328" y="260" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Freigabe_erfolgt__131_gui" bpmnElement="order_is_approved" isHorizontal="true" isMarkerVisible="true">
        <omgdc:Bounds x="479" y="280" width="40" height="40" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="472" y="325" width="55" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Freigebenden_zuordnen_143_gui" bpmnElement="assignApprover" isHorizontal="true">
        <omgdc:Bounds x="210" y="88" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Rechnung_kl_ren_148_gui" bpmnElement="reviewOrder" isHorizontal="true">
        <omgdc:Bounds x="591" y="97" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Kl_rung_erfolgreich__153_gui" bpmnElement="review_is_ok" isHorizontal="true" isMarkerVisible="true">
        <omgdc:Bounds x="772" y="117" width="40" height="40" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="764" y="162" width="55" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="endEvent_165_gui" bpmnElement="orderCanceled" isHorizontal="true">
        <omgdc:Bounds x="964" y="123" width="28" height="28" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="951" y="156" width="55" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="zberweisung_vorbereiten_169_gui" bpmnElement="pullMaterialService" isHorizontal="true">
        <omgdc:Bounds x="591" y="403" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Rechnungseingang_abgearbeitet_174_gui" bpmnElement="orderFinished" isHorizontal="true">
        <omgdc:Bounds x="1104" y="429" width="28" height="28" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="1097" y="462" width="44" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DataStoreReference_1_gui" bpmnElement="DataStoreReference_1" isHorizontal="true">
        <omgdc:Bounds x="710" y="552" width="63" height="61" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="712" y="618" width="57" height="36" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Nein_182_gui" bpmnElement="order_not_approved" sourceElement="Freigabe_erfolgt__131_gui" targetElement="Rechnung_kl_ren_148_gui">
        <omgdi:waypoint xsi:type="omgdc:Point" x="499" y="277" />
        <omgdi:waypoint xsi:type="omgdc:Point" x="499" y="137" />
        <omgdi:waypoint xsi:type="omgdc:Point" x="591" y="137" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="467" y="193" width="33" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="sequenceFlow_180_gui" bpmnElement="sequenceFlow_180" sourceElement="Rechnung_freigeben_125_gui" targetElement="Freigabe_erfolgt__131_gui">
        <omgdi:waypoint xsi:type="omgdc:Point" x="428" y="300" />
        <omgdi:waypoint xsi:type="omgdc:Point" x="479" y="300" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="454" y="285" width="0" height="0" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="sequenceFlow_183_gui" bpmnElement="sequenceFlow_183" sourceElement="Rechnung_kl_ren_148_gui" targetElement="Kl_rung_erfolgreich__153_gui">
        <omgdi:waypoint xsi:type="omgdc:Point" x="691" y="137" />
        <omgdi:waypoint xsi:type="omgdc:Point" x="772" y="137" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="732" y="122" width="0" height="0" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="sequenceFlow_178_gui" bpmnElement="sequenceFlow_178" sourceElement="Freigebenden_zuordnen_143_gui" targetElement="Rechnung_freigeben_125_gui">
        <omgdi:waypoint xsi:type="omgdc:Point" x="260" y="168" />
        <omgdi:waypoint xsi:type="omgdc:Point" x="260" y="300" />
        <omgdi:waypoint xsi:type="omgdc:Point" x="328" y="300" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="275" y="234" width="0" height="0" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_1_gui" bpmnElement="Association_1" sourceElement="DataStoreReference_1_gui" targetElement="zberweisung_vorbereiten_169_gui">
        <omgdi:waypoint xsi:type="omgdc:Point" x="729" y="552" />
        <omgdi:waypoint xsi:type="omgdc:Point" x="664" y="483" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Ja_181_gui" bpmnElement="order_approved" sourceElement="Freigabe_erfolgt__131_gui" targetElement="zberweisung_vorbereiten_169_gui">
        <omgdi:waypoint xsi:type="omgdc:Point" x="519" y="300" />
        <omgdi:waypoint xsi:type="omgdc:Point" x="591" y="300" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="538" y="280" width="22" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="nein_185_gui" bpmnElement="reviewNotSuccessful" sourceElement="Kl_rung_erfolgreich__153_gui" targetElement="endEvent_165_gui">
        <omgdi:waypoint xsi:type="omgdc:Point" x="812" y="137" />
        <omgdi:waypoint xsi:type="omgdc:Point" x="965" y="137" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="872" y="114" width="22" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="ja_186_gui" bpmnElement="reviewSuccessful" sourceElement="Kl_rung_erfolgreich__153_gui" targetElement="Rechnung_freigeben_125_gui">
        <omgdi:waypoint xsi:type="omgdc:Point" x="792" y="117" />
        <omgdi:waypoint xsi:type="omgdc:Point" x="792" y="71" />
        <omgdi:waypoint xsi:type="omgdc:Point" x="378" y="71" />
        <omgdi:waypoint xsi:type="omgdc:Point" x="378" y="260" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="795" y="84" width="22" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_SequenceFlow_1" bpmnElement="SequenceFlow_2" sourceElement="zberweisung_vorbereiten_169_gui" targetElement="_BPMNShape_ServiceTask_2">
        <omgdi:waypoint xsi:type="omgdc:Point" x="691" y="443" />
        <omgdi:waypoint xsi:type="omgdc:Point" x="742" y="443" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="703" y="420" width="22" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_3" bpmnElement="StartDraftOrderEvent">
        <omgdc:Bounds x="152" y="114" width="28" height="28" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="144" y="147" width="44" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="BPMNEdge_SequenceFlow_2" bpmnElement="SequenceFlow_1" sourceElement="_BPMNShape_StartEvent_3" targetElement="Freigebenden_zuordnen_143_gui">
        <omgdi:waypoint xsi:type="omgdc:Point" x="179" y="128" />
        <omgdi:waypoint xsi:type="omgdc:Point" x="210" y="128" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="195" y="113" width="0" height="0" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="_BPMNShape_ServiceTask_2" bpmnElement="pushProductService">
        <omgdc:Bounds x="742" y="403" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="BPMNEdge_SequenceFlow_3" bpmnElement="SequenceFlow_3" sourceElement="_BPMNShape_ServiceTask_2" targetElement="Rechnungseingang_abgearbeitet_174_gui">
        <omgdi:waypoint xsi:type="omgdc:Point" x="842" y="443" />
        <omgdi:waypoint xsi:type="omgdc:Point" x="928" y="443" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="885" y="428" width="0" height="0" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1pcdtz2_di" bpmnElement="SequenceFlow_1pcdtz2">
        <omgdi:waypoint xsi:type="omgdc:Point" x="792" y="325" />
        <omgdi:waypoint xsi:type="omgdc:Point" x="792" y="354" />
        <omgdi:waypoint xsi:type="omgdc:Point" x="641" y="354" />
        <omgdi:waypoint xsi:type="omgdc:Point" x="641" y="403" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="711" y="339" width="11" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ServiceTask_06mdb3v_di" bpmnElement="appendOrder">
        <omgdc:Bounds x="591" y="260" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="pullProductService_di" bpmnElement="pullProductService">
        <omgdc:Bounds x="928" y="403" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0hm5uwp_di" bpmnElement="SequenceFlow_0hm5uwp">
        <omgdi:waypoint xsi:type="omgdc:Point" x="1028" y="443" />
        <omgdi:waypoint xsi:type="omgdc:Point" x="1105" y="443" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="1067" y="428" width="0" height="0" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ExclusiveGateway_0awwr6x_di" bpmnElement="order_is_maken" isMarkerVisible="true">
        <omgdc:Bounds x="767" y="275" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="764" y="325" width="55" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1imjp93_di" bpmnElement="SequenceFlow_1imjp93">
        <omgdi:waypoint xsi:type="omgdc:Point" x="817" y="300" />
        <omgdi:waypoint xsi:type="omgdc:Point" x="978" y="300" />
        <omgdi:waypoint xsi:type="omgdc:Point" x="978" y="403" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="890" y="285" width="11" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1gcjbut_di" bpmnElement="SequenceFlow_1gcjbut">
        <omgdi:waypoint xsi:type="omgdc:Point" x="691" y="300" />
        <omgdi:waypoint xsi:type="omgdc:Point" x="767" y="300" />
        <bpmndi:BPMNLabel>
          <omgdc:Bounds x="729" y="285" width="0" height="0" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>
